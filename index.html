<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.36
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-LibUI">LibUI</h1>

<p><a href="https://github.com/kojix2/LibUI/actions/workflows/test.yml"><img src="https://github.com/kojix2/LibUI/actions/workflows/test.yml/badge.svg"></a> <a href="https://badge.fury.io/rb/libui"><img src="https://badge.fury.io/rb/libui.svg"></a> &lt;a href=“<a href="https://github.com/AndyObtiva/glimmer-dsl-libui">github.com/AndyObtiva/glimmer-dsl-libui</a>”&gt;&lt;img alt=“glimmer-dsl-libui” src=“<a href="https://github.com/AndyObtiva/glimmer/blob/master/images/glimmer-logo-hi-res.svg">github.com/AndyObtiva/glimmer/blob/master/images/glimmer-logo-hi-res.svg</a>” width=“50” height=“50” align=“right”&gt;&lt;/a&gt; <a href="https://github.com/kojix2/libui-ng/actions/workflows/pre-build.yml"><img src="https://github.com/kojix2/libui-ng/actions/workflows/pre-build.yml/badge.svg?branch=pre-build"></a></p>

<p>LibUI is a Ruby wrapper for libui and libui-ng.</p>

<p>:rocket: <a href="https://github.com/libui-ng/libui-ng">libui-ng</a> - A cross-platform portable GUI library</p>

<p>:radio_button: <a href="https://github.com/andlabs/libui">libui</a> - Original version by andlabs.</p>

<h2 id="label-Installation">Installation</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_libui'>libui</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_pre'>pre</span>   <span class='comment'># libui-ng
</span></code></pre>
<ul><li>
<p>The gem package includes the libui-ng shared library for Windows, Mac, and Linux.</p>
</li><li>
<p>Namely <code>libui.dll</code>, <code>libui.dylib</code>, or <code>libui.so</code>.</p>
</li><li>
<p>No dependencies required.</p>
</li><li>
<p>The libui gem uses the standard Ruby library <a href="https://github.com/ruby/fiddle">Fiddle</a> to call C functions.</p>
</li></ul>

<table role="table">
<thead>
<tr>
<th>Windows</th>
<th>Mac</th>
<th>Linux</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;img src=“<img src="https://user-images.githubusercontent.com/5798442/103118046-900ea780-46b0-11eb-81fc-32626762e4df.png" />”&gt;</td>
<td>&lt;img src=“<img src="https://user-images.githubusercontent.com/5798442/103118059-99980f80-46b0-11eb-9d12-324ec4d297c9.png" />”&gt;</td>
<td>&lt;img src=“<img src="https://user-images.githubusercontent.com/5798442/103118068-a0bf1d80-46b0-11eb-8c5c-3bdcc3dcfb26.png" />”&gt;</td>
</tr>
</tbody>
</table>

<p>Notes:</p>
<ul><li>
<p>If you are using the 32-bit (x86) version of Ruby, you need to download the 32-bit (x86) native dll. See the <a href="#development">Development</a> section.</p>
</li><li>
<p>On Windows, libui may not work due to missing DLLs. In that case, you need to install <a href="https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist">Visual C++ Redistributable</a>. See (<a href="https://github.com/kojix2/LibUI/issues/48">#48</a>)</p>
</li><li>
<p>Users with <a href="https://www.raspberrypi.com/">Raspberry Pi</a> or other platforms will need to compile the C libui library. See the <a href="#development">Development</a> section.</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>libui</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>UI</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="LibUI.html" title="LibUI (module)">LibUI</a></span></span>

<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>

<span class='id identifier rubyid_main_window'>main_window</span> <span class='op'>=</span> <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_new_window'>new_window</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>200</span><span class='comma'>,</span> <span class='int'>100</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>

<span class='id identifier rubyid_button'>button</span> <span class='op'>=</span> <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_new_button'>new_button</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Button</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_button_on_clicked'>button_on_clicked</span><span class='lparen'>(</span><span class='id identifier rubyid_button'>button</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_msg_box'>msg_box</span><span class='lparen'>(</span><span class='id identifier rubyid_main_window'>main_window</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Information</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You clicked the button</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_window_on_closing'>window_on_closing</span><span class='lparen'>(</span><span class='id identifier rubyid_main_window'>main_window</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Bye Bye</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_control_destroy'>control_destroy</span><span class='lparen'>(</span><span class='id identifier rubyid_main_window'>main_window</span><span class='rparen'>)</span>
  <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_quit'>quit</span>
  <span class='int'>0</span>
<span class='kw'>end</span>

<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_window_set_child'>window_set_child</span><span class='lparen'>(</span><span class='id identifier rubyid_main_window'>main_window</span><span class='comma'>,</span> <span class='id identifier rubyid_button'>button</span><span class='rparen'>)</span>
<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_control_show'>control_show</span><span class='lparen'>(</span><span class='id identifier rubyid_main_window'>main_window</span><span class='rparen'>)</span>

<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_main'>main</span>
<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_quit'>quit</span>
</code></pre>

<p>For more examples, see the <a href="https://github.com/kojix2/libui/tree/main/examples">examples</a> directory.</p>

<h3 id="label-General+Rules">General Rules</h3>

<p>Compared to the original libui library written in C:</p>
<ul><li>
<p>Method names use snake_case.</p>
</li><li>
<p>The last argument can be omitted if it’s nil.</p>
</li><li>
<p>A block can be passed as a callback.</p>
</li><li>
<p>The block will be converted to a Proc object and added as the last argument.</p>
</li><li>
<p>The last argument can still be omitted when nil.</p>
</li></ul>

<p>You can use <a href="https://pkg.go.dev/github.com/andlabs/ui">the documentation for libui’s Go bindings</a> as a reference.</p>

<h3 id="label-DSLs+for+LibUI">DSLs for LibUI</h3>

<p>LibUI is not object-oriented because it is a thin Ruby wrapper (binding) for the procedural C libui library, mirroring its API structure.</p>

<p>To build actual applications, it is recommended to use a DSL for LibUI, as they enable writing object-oriented code the Ruby way (instead of procedural code the C way):</p>
<ul><li>
<p><a href="https://github.com/AndyObtiva/glimmer-dsl-libui">Glimmer DSL for LibUI</a></p>
</li><li>
<p><a href="https://rubygems.org/gems/libui_paradise">libui_paradise</a></p>
</li></ul>

<h3 id="label-Working+with+fiddle+pointers">Working with fiddle pointers</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>libui</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>UI</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="LibUI.html" title="LibUI (module)">LibUI</a></span></span>
<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>
</code></pre>

<p>To convert a pointer to a string:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_new_label'>new_label</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_pointer'>pointer</span> <span class='op'>=</span> <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_label_text'>label_text</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='rparen'>)</span> <span class='comment'># #&lt;Fiddle::Pointer&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_pointer'>pointer</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='comment'># Ruby
</span></code></pre>

<p>If you need to use C structs, you can do the following:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_font_button'>font_button</span> <span class='op'>=</span> <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_new_font_button'>new_font_button</span>

<span class='comment'># Allocate memory
</span><span class='id identifier rubyid_font_descriptor'>font_descriptor</span> <span class='op'>=</span> <span class='const'>UI</span><span class='op'>::</span><span class='const'>FFI</span><span class='op'>::</span><span class='const'>FontDescriptor</span><span class='period'>.</span><span class='id identifier rubyid_malloc'>malloc</span>
<span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='id identifier rubyid_to_ptr'>to_ptr</span><span class='period'>.</span><span class='id identifier rubyid_free'>free</span> <span class='op'>=</span> <span class='const'>Fiddle</span><span class='op'>::</span><span class='const'>RUBY_FREE</span>
<span class='comment'># font_descriptor = UI::FFI::FontDescriptor.malloc(Fiddle::RUBY_FREE) # fiddle 1.0.1 or higher
</span>
<span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_font_button_on_changed'>font_button_on_changed</span><span class='lparen'>(</span><span class='id identifier rubyid_font_button'>font_button</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='const'>UI</span><span class='period'>.</span><span class='id identifier rubyid_font_button_font'>font_button_font</span><span class='lparen'>(</span><span class='id identifier rubyid_font_button'>font_button</span><span class='comma'>,</span> <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_p'>p</span> <span class='label'>family:</span>  <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='const'>Family</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
    <span class='label'>size:</span>    <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='const'>Size</span><span class='comma'>,</span>
    <span class='label'>weight:</span>  <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='const'>Weight</span><span class='comma'>,</span>
    <span class='label'>italic:</span>  <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='const'>Italic</span><span class='comma'>,</span>
    <span class='label'>stretch:</span> <span class='id identifier rubyid_font_descriptor'>font_descriptor</span><span class='period'>.</span><span class='const'>Stretch</span>
<span class='kw'>end</span>
</code></pre>
<ul><li>
<p>Callbacks</p>
</li><li>
<p>In Ruby/Fiddle, a C callback function is written as an object of <code>Fiddle::Closure::BlockCaller</code> or <code>Fiddle::Closure</code>. Be careful about Ruby’s garbage collection - if the function object is collected, memory will be freed resulting in a segmentation violation when the callback is invoked.</p>
</li></ul>

<pre class="code ruby"><code class="ruby"><span class='comment'># Assign to a local variable to prevent it from being collected by GC.
</span><span class='id identifier rubyid_handler'>handler</span><span class='period'>.</span><span class='const'>MouseEvent</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c1'>c1</span> <span class='op'>=</span> <span class='const'>Fiddle</span><span class='op'>::</span><span class='const'>Closure</span><span class='op'>::</span><span class='const'>BlockCaller</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_handler'>handler</span><span class='period'>.</span><span class='const'>MouseCrossed</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c2'>c2</span> <span class='op'>=</span> <span class='const'>Fiddle</span><span class='op'>::</span><span class='const'>Closure</span><span class='op'>::</span><span class='const'>BlockCaller</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_handler'>handler</span><span class='period'>.</span><span class='const'>DragBroken</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_c3'>c3</span> <span class='op'>=</span> <span class='const'>Fiddle</span><span class='op'>::</span><span class='const'>Closure</span><span class='op'>::</span><span class='const'>BlockCaller</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<h3 id="label-Creating+a+Windows+executable+-28.exe-29+with+OCRA">Creating a Windows executable (.exe) with OCRA</h3>

<p>OCRA (One-Click Ruby Application) builds Windows executables from Ruby source code.</p>
<ul><li>
<p><a href="https://github.com/larsch/ocra">github.com/larsch/ocra</a>/</p>
</li></ul>

<p>To build an exe with Ocra, include 3 DLLs from the ruby_builtin_dlls folder:</p>

<pre class="code ruby"><code class="ruby">ocra examples/control_gallery.rb        ^
  --dll ruby_builtin_dlls/libssp-0.dll  ^
  --dll ruby_builtin_dlls/libgmp-10.dll ^
  --dll ruby_builtin_dlls/libffi-7.dll  ^
  --gem-all=fiddle                      ^
</code></pre>

<p>Add additional options below if necessary:</p>

<pre class="code ruby"><code class="ruby">--window                              ^
  --add-all-core                        ^
  --chdir-first                         ^
  --icon assets\app.ico                 ^
  --verbose                             ^
  --output out\gallery.exe
</code></pre>

<h2 id="label-Development">Development</h2>

<pre class="code ruby"><code class="ruby">git clone https://github.com/kojix2/libui
cd libui
bundle install
bundle exec rake vendor:auto # vendor:build
bundle exec rake test
</code></pre>

<h3 id="label-Pre-built+shared+libraries+for+libui-ng">Pre-built shared libraries for libui-ng</h3>

<p>Use the following rake tasks to download the shared library required for your platform:</p>

<p><code>rake -T</code></p>

<pre class="code ruby"><code class="ruby">rake vendor:build[hash]          # Build libui-ng latest master [commit hash]
rake vendor:libui-ng:macos       # Download latest official pre-build for Mac to vendor directory
rake vendor:libui-ng:ubuntu_x64  # Download latest official pre-build for Ubuntu to vendor directory
rake vendor:macos_arm64          # Download pre-build for Mac to vendor directory
rake vendor:macos_x64            # Download pre-build for Mac to vendor directory
rake vendor:raspbian_aarch64     # Download pre-build for Raspbian to vendor directory
rake vendor:ubuntu_x64           # Download pre-build for Ubuntu to vendor directory
rake vendor:windows_x64          # Download pre-build for Windows to vendor directory
rake vendor:windows_x86          # Download pre-build for Windows to vendor directory
</code></pre>

<p>For example, if you are using a 32-bit (x86) version of Ruby on Windows, type <code>vendor:windows_x86</code>. These shared libraries are <a href="https://github.com/kojix2/libui-ng/actions/workflows/pre-build.yml">artifacts</a> of the <a href="https://github.com/kojix2/libui-ng/tree/pre-build">pre-build branch</a> of <a href="https://github.com/kojix2/libui-ng">kojix2/libui-ng</a>. In that case, please let us know.</p>

<h3 id="label-Using+C+libui+compiled+from+source+code">Using C libui compiled from source code</h3>

<p>The following Rake task will compile libui-ng. meson or ninja is required.</p>

<p><code>bundle exec rake vendor:build</code></p>

<p>Alternatively, you can tell Ruby LibUI the location of shared libraries. Set the environment variable <code>LIBUIDIR</code> to specify the path to the shared library. (See <a href="https://github.com/kojix2/LibUI/issues/46#issuecomment-1041575792">#46</a>). This is especially useful on platforms where the LibUI gem does not provide shared library, such as the ARM architecture (used in devices like Raspberry Pi).</p>

<p>Another simple approach is to replace the shared libraries in the gem vendor directory with the ones you have compiled.</p>

<h3 id="label-Publishing+gems">Publishing gems</h3>

<pre class="code ruby"><code class="ruby">ls vendor             # check the vendor directory
rm -rf pkg            # remove previously built gems
rake build_platform   # build gems

# Check the contents of the gem
find pkg -name *.gem -exec sh -c &quot;echo; echo \# {}; tar -O -f {} -x data.tar.gz | tar zt&quot; \;

rake release_platform # publish gems
</code></pre>

<h3 id="label-libui+or+libui-ng">libui or libui-ng</h3>
<ul><li>
<p>From version 0.1.X, we plan to support only libui-ng/libui-ng.</p>
</li><li>
<p>Version 0.0.X only supports andlabs/libui.</p>
</li></ul>

<h2 id="label-Contributing">Contributing</h2>

<p>Would you like to contribute to LibUI?</p>
<ul><li>
<p>Please feel free to send us your <a href="https://github.com/kojix2/libui/pulls">pull requests</a>.</p>
</li><li>
<p>Small corrections, such as typo fixes, are appreciated.</p>
</li><li>
<p>Did you find any bugs? Submit them in the <a href="https://github.com/kojix2/LibUI/issues">issues</a> section!</p>
</li></ul>

<p>Do you need commit rights?</p>
<ul><li>
<p>If you need commit rights to my repository or want to get admin rights and take over the project, please feel free to contact @kojix2.</p>
</li><li>
<p>Many OSS projects become abandoned because only the founder has commit rights to the original repository.</p>
</li></ul>

<p>Support libui-ng development</p>
<ul><li>
<p>Contributing to the development of libui-ng is a contribution to the entire libui community, including Ruby’s LibUI.</p>
</li><li>
<p>For example, it would be easier to release LibUI in Ruby if libui-ng could be built easily and official shared libraries could be distributed.</p>
</li></ul>

<h2 id="label-Acknowledgements">Acknowledgements</h2>

<p>This project is inspired by libui-ruby.</p>
<ul><li>
<p><a href="https://github.com/jamescook/libui-ruby">github.com/jamescook/libui-ruby</a></p>
</li></ul>

<p>While libui-ruby uses <a href="https://github.com/ffi/ffi">Ruby-FFI</a>, this gem uses <a href="https://github.com/ruby/fiddle">Fiddle</a>.</p>

<h2 id="label-License">License</h2>

<p><a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

      <div id="footer">
  Generated on Sat Jul 20 11:55:36 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.3.4).
</div>

    </div>
  </body>
</html>